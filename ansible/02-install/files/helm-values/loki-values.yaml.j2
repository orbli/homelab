# Loki Helm Chart Values
# Generated for {{ namespace }} namespace

loki:
  auth_enabled: false
  
  # Storage configuration
  storage:
    type: filesystem
  
  # Common configuration
  commonConfig:
    replication_factor: 1
    path_prefix: /var/loki
    
  # Schema configuration
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  
  # Storage configuration for filesystem
  storage_config:
    filesystem:
      directory: /var/loki/chunks
    tsdb_shipper:
      active_index_directory: /var/loki/tsdb-index
      cache_location: /var/loki/tsdb-cache
  
  # Limits configuration
  limits_config:
    reject_old_samples: true
    reject_old_samples_max_age: 168h
    max_cache_freshness_per_query: 10m
    split_queries_by_interval: 30m
    retention_period: 720h  # 30 days
    max_query_parallelism: 32
    ingestion_rate_mb: 100
    ingestion_burst_size_mb: 200
    per_stream_rate_limit: 10MB
    per_stream_rate_limit_burst: 20MB
  
  # Query scheduler configuration
  query_scheduler:
    max_outstanding_requests_per_tenant: 2048
  
  # Frontend configuration
  frontend:
    max_outstanding_per_tenant: 2048
    compress_responses: true
  
  # Query range configuration
  query_range:
    parallelise_shardable_queries: true
  
  # Compactor configuration
  compactor:
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 50
    delete_request_store: filesystem

# Deployment mode - single binary
deploymentMode: SingleBinary

# Single binary configuration
singleBinary:
  replicas: 1
  
  # Resource requests and limits
  resources:
    limits:
      cpu: 2
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  # Persistence configuration
  persistence:
    enabled: true
    storageClass: "{{ storage_class }}"
    size: {{ loki_storage_size }}

# Service configuration
service:
  type: ClusterIP
  port: 3100

# Monitoring
monitoring:
  selfMonitoring:
    enabled: false
    grafanaAgent:
      installOperator: false
  
  serviceMonitor:
    enabled: true
    interval: 30s
    labels:
      release: prometheus

# Test configuration
test:
  enabled: false

# Gateway (nginx) - disabled since we don't need it
gateway:
  enabled: false

# Backend - not needed in single binary mode
backend:
  replicas: 0

# Read path - not needed in single binary mode  
read:
  replicas: 0

# Write path - not needed in single binary mode
write:
  replicas: 0

# Ingress - not needed with Tailscale
ingress:
  enabled: false

# Network policy
networkPolicy:
  enabled: false