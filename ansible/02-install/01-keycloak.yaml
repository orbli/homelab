---
- name: Install Keycloak using Helm
  hosts: localhost
  connection: local
  gather_facts: false
  
  tasks:
    - name: Add Bitnami Helm repository
      kubernetes.core.helm_repository:
        name: bitnami
        repo_url: https://charts.bitnami.com/bitnami
        state: present
    
    - name: Create iam namespace
      kubernetes.core.k8s:
        name: iam
        api_version: v1
        kind: Namespace
        state: present
    
    - name: Install Keycloak using Helm chart
      kubernetes.core.helm:
        name: keycloak
        chart_ref: bitnami/keycloak
        chart_version: "24.7.0"
        release_namespace: iam
        create_namespace: false
        state: present
        timeout: 10m0s
        wait: true
        values:
          tls:
            enabled: true
            autoGenerated: true 

# username: user
# password: `kubectl -n iam get secret keycloak -o json | jq -r '.data["admin-password"]' | base64 -d`
